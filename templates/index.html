<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¶œê·¼í•˜ì</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f3f4f6;
            min-height: 100vh;
            padding-bottom: 70px;
        }
        
        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header .greeting {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* ì¹´ë“œ */
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card-title {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 10px;
        }
        
        /* ì˜¤ëŠ˜ í˜„í™© ì¹´ë“œ */
        .today-card {
            text-align: center;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .status-badge.working {
            background: #DEF7EC;
            color: #03543F;
        }
        
        .status-badge.not-working {
            background: #FDE8E8;
            color: #9B1C1C;
        }
        
        .status-badge.done {
            background: #E1EFFE;
            color: #1E40AF;
        }
        
        .time-display {
            font-size: 36px;
            font-weight: 700;
            color: #1f2937;
            margin: 10px 0;
        }
        
        .time-detail {
            font-size: 14px;
            color: #6b7280;
        }
        
        /* ì¶œí‡´ê·¼ ë²„íŠ¼ */
        .clock-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-clock-in {
            background: #10B981;
            color: white;
        }
        
        .btn-clock-in:disabled {
            background: #d1d5db;
            color: #9ca3af;
        }
        
        .btn-clock-out {
            background: #EF4444;
            color: white;
        }
        
        .btn-clock-out:disabled {
            background: #d1d5db;
            color: #9ca3af;
        }
        
        /* ì£¼ê°„ ì§„í–‰ë¥  */
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4F46E5, #7C3AED);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 14px;
            color: #6b7280;
        }
        
        /* ì¼ë³„ í˜„í™© */
        .daily-list {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .daily-item {
            text-align: center;
            flex: 1;
        }
        
        .daily-day {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 5px;
        }
        
        .daily-hours {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .daily-hours.today {
            color: #4F46E5;
        }
        
        .daily-hours.leave {
            color: #F59E0B;
        }
        
        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #9ca3af;
            cursor: pointer;
            padding: 5px 15px;
        }
        
        .nav-item.active {
            color: #4F46E5;
        }
        
        .nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 3px;
        }
        
        /* í˜ì´ì§€ë“¤ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* íŒ€ í˜„í™© */
        .member-card {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .member-card:last-child {
            border-bottom: none;
        }
        
        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .member-schedule {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .member-status {
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .member-status.working {
            background: #DEF7EC;
            color: #03543F;
        }
        
        .member-status.not-working {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .member-status.done {
            background: #E1EFFE;
            color: #1E40AF;
        }
        
        .member-status.leave {
            background: #FEF3C7;
            color: #92400E;
        }
        
        /* ì¼ì • */
        .schedule-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .schedule-day {
            width: 50px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .schedule-time {
            flex: 1;
            display: flex;
            gap: 10px;
        }
        
        .schedule-time input {
            width: 80px;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
        }
        
        /* íœ´ê°€ */
        .leave-form {
            margin-bottom: 20px;
        }
        
        .leave-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .leave-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .leave-type-btn.selected {
            border-color: #4F46E5;
            background: #EEF2FF;
            color: #4F46E5;
        }
        
        .leave-balance {
            background: #F3F4F6;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .leave-balance-number {
            font-size: 28px;
            font-weight: 700;
            color: #4F46E5;
        }
        
        /* ë¡œê·¸ì¸ */
        .login-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        }
        
        .login-box {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 350px;
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .login-subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 25px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            font-size: 14px;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .btn-login {
            width: 100%;
            padding: 14px;
            background: #4F46E5;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .login-toggle {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .login-toggle a {
            color: #4F46E5;
            cursor: pointer;
        }
        
        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
        }
        
        .toast.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* ìˆ˜ì • ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons .btn {
            background: #4F46E5;
            color: white;
        }
        
        .modal-buttons .btn-cancel {
            background: #e5e7eb;
            color: #374151;
        }
        
        /* ìœ„ì¹˜ ìƒíƒœ */
        .location-status {
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .location-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
        }
        
        .location-dot.ok {
            background: #10B981;
        }
        
        .location-dot.far {
            background: #EF4444;
        }
    </style>
</head>
<body>
    <!-- í† ìŠ¤íŠ¸ -->
    <div id="toast" class="toast"></div>
    
    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <h1 class="login-title">â° ì¶œê·¼í•˜ì</h1>
            
            <div id="loginForm">
                <div class="input-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="loginEmail" placeholder="email@company.com">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                <button class="btn-login" onclick="login()">ë¡œê·¸ì¸</button>
                <p class="login-toggle">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="showRegister()">íšŒì›ê°€ì…</a></p>
            </div>
            
            <div id="registerForm" style="display:none;">
                <div class="input-group">
                    <label>ì´ë¦„</label>
                    <input type="text" id="regName" placeholder="í™ê¸¸ë™">
                </div>
                <div class="input-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="regEmail" placeholder="email@company.com">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="regPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                <div class="input-group">
                    <label>íŒ€</label>
                    <select id="regTeam"></select>
                </div>
                <button class="btn-login" onclick="register()">íšŒì›ê°€ì…</button>
                <p class="login-toggle">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="showLogin()">ë¡œê·¸ì¸</a></p>
            </div>
        </div>
    </div>
    
    <!-- ë©”ì¸ ì•± -->
    <div id="mainApp" style="display:none;">
        <div class="header">
            <h1>â° ì¶œê·¼í•˜ì</h1>
            <p class="greeting" id="greetingText">ì•ˆë…•í•˜ì„¸ìš”!</p>
        </div>
        
        <!-- í™ˆ í˜ì´ì§€ -->
        <div id="homePage" class="page active">
            <div class="container">
                <div class="card today-card">
                    <div class="card-title">ğŸ“… ì˜¤ëŠ˜ <span id="todayDate"></span></div>
                    <div id="todayStatus" class="status-badge not-working">ë¯¸ì¶œê·¼</div>
                    <div class="time-display" id="workTime">0ì‹œê°„ 0ë¶„</div>
                    <div class="time-detail" id="clockTimes">-</div>
                    
                    <div class="location-status" id="locationStatus">
                        <span class="location-dot" id="locationDot"></span>
                        <span id="locationText">ìœ„ì¹˜ í™•ì¸ ì¤‘...</span>
                    </div>
                    
                    <div class="clock-buttons">
                        <button id="btnClockIn" class="btn btn-clock-in" onclick="clockIn()">ğŸŸ¢ ì¶œê·¼</button>
                        <button id="btnClockOut" class="btn btn-clock-out" onclick="clockOut()" disabled>ğŸ”´ í‡´ê·¼</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ“Š ì´ë²ˆ ì£¼ í˜„í™©</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="weeklyProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="weeklyHours">0ì‹œê°„</span>
                            <span>ëª©í‘œ: 40ì‹œê°„</span>
                        </div>
                    </div>
                    <div class="daily-list" id="dailyList"></div>
                </div>
                
            </div>
        </div>
        
        <!-- ì¼ì • í˜ì´ì§€ -->
        <div id="schedulePage" class="page">
            <div class="container">
                <div class="card">
                    <div class="card-title">ğŸ“… ì´ë²ˆ ì£¼ ì¶œí‡´ê·¼ ì˜ˆì •</div>
                    <div id="scheduleList"></div>
                    <button class="btn" style="background:#4F46E5; color:white; width:100%; margin-top:15px;" onclick="saveSchedule()">ì €ì¥</button>
                </div>
            </div>
        </div>
        
        <!-- íŒ€ í˜ì´ì§€ -->
        <div id="teamPage" class="page">
            <div class="container">
                <div class="card">
                    <div class="card-title">ğŸ‘¥ ìš°ë¦¬ íŒ€ í˜„í™©</div>
                    <p style="font-size:12px; color:#9ca3af; margin-bottom:15px;">íŒ€ì›ì„ í„°ì¹˜í•˜ë©´ ì´ë²ˆ ì£¼ ì¼ì •ì„ ë³¼ ìˆ˜ ìˆì–´ìš”</p>
                    <div id="teamList"></div>
                </div>
            </div>
        </div>
        
        <!-- íŒ€ì› ì¼ì • ëª¨ë‹¬ -->
        <div id="memberScheduleModal" class="modal">
            <div class="modal-content" style="max-width:400px;">
                <div class="modal-title" id="memberScheduleTitle">ğŸ“… ì´ë²ˆ ì£¼ ì¼ì •</div>
                <div id="memberScheduleContent"></div>
                <div class="modal-buttons">
                    <button class="btn" style="width:100%;" onclick="closeMemberSchedule()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
        
        <!-- íœ´ê°€ í˜ì´ì§€ -->
        <div id="leavePage" class="page">
            <div class="container">
                <div class="card">
                    <div class="leave-balance">
                        <div style="font-size:14px; color:#6b7280;">ì”ì—¬ ì—°ì°¨</div>
                        <div class="leave-balance-number" id="leaveBalance">0ì¼</div>
                        <div style="font-size:12px; color:#9ca3af;" id="leaveUsed">ì‚¬ìš©: 0ì¼ / ì´: 15ì¼</div>
                    </div>
                    
                    <div class="card-title">ğŸ–ï¸ íœ´ê°€ ë“±ë¡</div>
                    <div class="leave-form">
                        <div class="leave-type-buttons">
                            <div class="leave-type-btn selected" onclick="selectLeaveType(this, 'annual')">ì—°ì°¨<br><small>1ì¼</small></div>
                            <div class="leave-type-btn" onclick="selectLeaveType(this, 'half_am')">ì˜¤ì „ë°˜ì°¨<br><small>0.5ì¼</small></div>
                            <div class="leave-type-btn" onclick="selectLeaveType(this, 'half_pm')">ì˜¤í›„ë°˜ì°¨<br><small>0.5ì¼</small></div>
                        </div>
                        <div class="input-group">
                            <label>ë‚ ì§œ</label>
                            <input type="date" id="leaveDate">
                        </div>
                        <button class="btn" style="background:#4F46E5; color:white; width:100%;" onclick="submitLeave()">íœ´ê°€ ë“±ë¡</button>
                    </div>
                    
                    <div class="card-title" style="margin-top:20px;">ğŸ“‹ íœ´ê°€ ë‚´ì—­</div>
                    <div id="leaveList"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">âš™ï¸ ì—°ì°¨ ì„¤ì •</div>
                    <div class="input-group">
                        <label>ì´ ì—°ì°¨ ì¼ìˆ˜</label>
                        <input type="number" id="totalAnnualLeave" step="0.5" min="0">
                    </div>
                    <button class="btn" style="background:#6b7280; color:white; width:100%;" onclick="updateAnnualLeave()">ì €ì¥</button>
                </div>
            </div>
        </div>
        
        <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
        <div id="adminPage" class="page">
            <div class="container">
                <!-- íƒ­ ë©”ë‰´ -->
                <div style="display:flex; gap:5px; margin-bottom:15px; background:white; border-radius:12px; padding:5px;">
                    <button id="adminTab1" class="btn" style="flex:1; background:#4F46E5; color:white; padding:10px;" onclick="showAdminTab('status')">ì¶œí‡´ê·¼ í˜„í™©</button>
                    <button id="adminTab2" class="btn" style="flex:1; background:#e5e7eb; color:#374151; padding:10px;" onclick="showAdminTab('hours')">ê·¼ë¬´ì‹œê°„</button>
                    <button id="adminTab3" class="btn" style="flex:1; background:#e5e7eb; color:#374151; padding:10px;" onclick="showAdminTab('team')">íŒ€ ê´€ë¦¬</button>
                </div>
                
                <!-- ì¶œí‡´ê·¼ í˜„í™© íƒ­ -->
                <div id="adminStatusTab" class="card">
                    <div class="card-title">ğŸ‘‘ ì˜¤ëŠ˜ ì „ì²´ ì§ì› í˜„í™©</div>
                    <div id="adminList"></div>
                </div>
                
                <!-- ê·¼ë¬´ì‹œê°„ íƒ­ -->
                <div id="adminHoursTab" class="card" style="display:none;">
                    <div class="card-title">ğŸ“Š ì§ì›ë³„ ê·¼ë¬´ì‹œê°„</div>
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <button id="hoursWeekBtn" class="btn" style="flex:1; background:#4F46E5; color:white;" onclick="loadAdminHours('week')">ì£¼ê°„</button>
                        <button id="hoursMonthBtn" class="btn" style="flex:1; background:#e5e7eb; color:#374151;" onclick="loadAdminHours('month')">ì›”ê°„</button>
                    </div>
                    <div id="adminHoursList"></div>
                </div>
                
                <!-- íŒ€ ê´€ë¦¬ íƒ­ -->
                <div id="adminTeamTab" class="card" style="display:none;">
                    <div class="card-title">ğŸ¢ íŒ€ ê´€ë¦¬</div>
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <input type="text" id="newTeamName" placeholder="ìƒˆ íŒ€ ì´ë¦„" style="flex:1; padding:10px; border:1px solid #e5e7eb; border-radius:8px;">
                        <button class="btn" style="background:#4F46E5; color:white; padding:10px 20px;" onclick="createTeam()">ì¶”ê°€</button>
                    </div>
                    <div id="adminTeamList"></div>
                </div>
            </div>
        </div>
        
        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('home')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                í™ˆ
            </div>
            <div class="nav-item" onclick="showPage('schedule')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                ì¼ì •
            </div>
            <div class="nav-item" onclick="showPage('team')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                íŒ€
            </div>
            <div class="nav-item" onclick="showPage('leave')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>
                íœ´ê°€
            </div>
            <div class="nav-item" id="adminNav" style="display:none;" onclick="showPage('admin')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                ê´€ë¦¬
            </div>
        </div>
    </div>
    
    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">âœï¸ ì¶œí‡´ê·¼ ê¸°ë¡ ìˆ˜ì •</div>
            <div class="input-group">
                <label>ë‚ ì§œ</label>
                <input type="date" id="editDate">
            </div>
            <div class="input-group">
                <label>ì¶œê·¼ ì‹œê°„</label>
                <input type="time" id="editClockIn">
            </div>
            <div class="input-group">
                <label>í‡´ê·¼ ì‹œê°„</label>
                <input type="time" id="editClockOut">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
                <button class="btn" onclick="saveEdit()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        let currentUser = null;
        let currentLocation = null;
        let selectedLeaveType = 'annual';
        const API_BASE = '';
        
        // ==================== ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', async () => {
            // ì €ì¥ëœ ì‚¬ìš©ì í™•ì¸
            const saved = localStorage.getItem('flextime_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                showMainApp();
            }
            
            // íŒ€ ëª©ë¡ ë¡œë“œ
            await loadTeams();
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            const today = new Date();
            document.getElementById('todayDate').textContent = 
                `${today.getMonth()+1}ì›” ${today.getDate()}ì¼ (${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][today.getDay()]})`;
            
            // íœ´ê°€ ë‚ ì§œ ê¸°ë³¸ê°’
            document.getElementById('leaveDate').valueAsDate = today;
            document.getElementById('editDate').valueAsDate = today;
            
            // ìœ„ì¹˜ ì¶”ì  ì‹œì‘
            startLocationTracking();
        });
        
        // ==================== ìœ„ì¹˜ ====================
        let clockInTime = null;  // ì¶œê·¼ ì‹œê°„
        let outsideStartTime = null;  // íšŒì‚¬ ë°–ìœ¼ë¡œ ë‚˜ê°„ ì‹œê°„
        let insideStartTime = null;  // íšŒì‚¬ ì•ˆì— ë“¤ì–´ì˜¨ ì‹œê°„ (ì¶œê·¼ ì•ˆ ëˆ„ë¥¸ ìƒíƒœ)
        let alarmShown = false;  // ì•ŒëŒ ì¤‘ë³µ ë°©ì§€
        
        function startLocationTracking() {
            if (!navigator.geolocation) {
                document.getElementById('locationText').textContent = 'ìœ„ì¹˜ ê¸°ëŠ¥ ë¯¸ì§€ì›';
                return;
            }
            
            navigator.geolocation.watchPosition(
                (pos) => {
                    currentLocation = {
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude
                    };
                    checkLocationStatus();
                },
                (err) => {
                    document.getElementById('locationText').textContent = 'ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”';
                    document.getElementById('locationDot').className = 'location-dot far';
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
            );
        }
        
        async function checkLocationStatus() {
            const settings = await fetch(`${API_BASE}/api/settings`).then(r => r.json());
            const distance = calculateDistance(
                currentLocation.latitude, currentLocation.longitude,
                settings.latitude, settings.longitude
            );
            
            const isNearby = distance <= settings.radius_meters;
            const isTooFar = distance > 1000; // 1km ì´ìƒ ë©€ì–´ì§€ë©´
            
            document.getElementById('locationDot').className = `location-dot ${isNearby ? 'ok' : 'far'}`;
            document.getElementById('locationText').textContent = isNearby 
                ? `íšŒì‚¬ ê·¼ì²˜ (${Math.round(distance)}m)` 
                : `íšŒì‚¬ì—ì„œ ${Math.round(distance)}m ë–¨ì–´ì§`;
            
            const btnIn = document.getElementById('btnClockIn');
            const btnOut = document.getElementById('btnClockOut');
            const isWorking = !btnOut.disabled;  // í‡´ê·¼ ë²„íŠ¼ í™œì„±í™” = ê·¼ë¬´ì¤‘
            
            // === ê·¼ë¬´ì¤‘ì¼ ë•Œ ===
            if (isWorking) {
                if (!isNearby) {
                    // íšŒì‚¬ ë°–ìœ¼ë¡œ ë‚˜ê°
                    if (!outsideStartTime) {
                        outsideStartTime = new Date();
                    }
                    
                    // ì¶œê·¼ í›„ 1ì‹œê°„ 30ë¶„ ê²½ê³¼í–ˆëŠ”ì§€ í™•ì¸
                    const now = new Date();
                    const clockInElapsed = clockInTime ? (now - clockInTime) / 1000 / 60 : 0;  // ë¶„
                    const outsideElapsed = (now - outsideStartTime) / 1000 / 60;  // ë¶„
                    
                    if (clockInElapsed >= 90) {
                        // 1ì‹œê°„ 30ë¶„ ì´í›„ â†’ 10ë¶„ ì´ìƒ ë°–ì— ìˆìœ¼ë©´ ìë™ í‡´ê·¼
                        if (outsideElapsed >= 10) {
                            await autoClockOut();
                            outsideStartTime = null;
                        }
                    }
                    
                    // 1km ì´ìƒì´ë©´ ì¦‰ì‹œ ìë™ í‡´ê·¼
                    if (isTooFar) {
                        await autoClockOut();
                        outsideStartTime = null;
                    }
                } else {
                    // íšŒì‚¬ ì•ˆì— ìˆìŒ â†’ ì¹´ìš´íŠ¸ ë¦¬ì…‹
                    outsideStartTime = null;
                }
            } 
            // === ê·¼ë¬´ì¤‘ ì•„ë‹ ë•Œ ===
            else {
                // ì¶œê·¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                btnIn.disabled = !isNearby;
                
                if (isNearby) {
                    // íšŒì‚¬ ì•ˆì— ìˆëŠ”ë° ì¶œê·¼ ì•ˆ ëˆ„ë¦„
                    if (!insideStartTime) {
                        insideStartTime = new Date();
                        alarmShown = false;
                    }
                    
                    const now = new Date();
                    const insideElapsed = (now - insideStartTime) / 1000 / 60;  // ë¶„
                    
                    // 10ë¶„ ì´ìƒ íšŒì‚¬ì— ìˆëŠ”ë° ì¶œê·¼ ì•ˆ ëˆ„ë¦„ â†’ ì•Œë¦¼
                    if (insideElapsed >= 10 && !alarmShown) {
                        showClockInReminder();
                        alarmShown = true;
                    }
                } else {
                    // íšŒì‚¬ ë°– â†’ ì¹´ìš´íŠ¸ ë¦¬ì…‹
                    insideStartTime = null;
                    alarmShown = false;
                }
            }
        }
        
        function showClockInReminder() {
            // ì§„ë™ (ëª¨ë°”ì¼)
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            
            // ì•Œë¦¼ì°½
            showToast('â° ì¶œê·¼ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!');
            
            // ë¸Œë¼ìš°ì € ì•Œë¦¼ (ê¶Œí•œ ìˆìœ¼ë©´)
            if (Notification.permission === 'granted') {
                new Notification('ì¶œê·¼í•˜ì', {
                    body: 'íšŒì‚¬ì— 10ë¶„ ì´ìƒ ê³„ì…¨ì–´ìš”. ì¶œê·¼ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!',
                    icon: 'â°'
                });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
        }
        
        async function autoClockOut() {
            try {
                const res = await fetch(`${API_BASE}/api/attendance/clock-out`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser.id })
                });
                
                const data = await res.json();
                if (res.ok) {
                    // ì‹œê°„ ê¸°ë¡ ë¦¬ì…‹
                    clockInTime = null;
                    outsideStartTime = null;
                    
                    showToast('ğŸ“ ìë™ í‡´ê·¼ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    await loadTodayAttendance();
                    await loadWeeklyAttendance();
                }
            } catch (e) {
                console.log('ìë™ í‡´ê·¼ ì²˜ë¦¬ ì‹¤íŒ¨:', e);
            }
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000;
            const phi1 = lat1 * Math.PI / 180;
            const phi2 = lat2 * Math.PI / 180;
            const deltaPhi = (lat2 - lat1) * Math.PI / 180;
            const deltaLambda = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(deltaPhi/2)**2 + Math.cos(phi1) * Math.cos(phi2) * Math.sin(deltaLambda/2)**2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            
            return R * c;
        }
        
        // ==================== ì¸ì¦ ====================
        async function loadTeams() {
            const teams = await fetch(`${API_BASE}/api/teams`).then(r => r.json());
            const select = document.getElementById('regTeam');
            select.innerHTML = teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
        }
        
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }
        
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }
        
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const res = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                
                const data = await res.json();
                currentUser = data.user;
                localStorage.setItem('flextime_user', JSON.stringify(currentUser));
                showMainApp();
                showToast('ë¡œê·¸ì¸ ì„±ê³µ! ğŸ‘‹');
            } catch (e) {
                showToast(e.message);
            }
        }
        
        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const team_id = parseInt(document.getElementById('regTeam').value);
            
            try {
                const res = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, team_id })
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                
                showToast('íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”');
                showLogin();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        function logout() {
            localStorage.removeItem('flextime_user');
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
        }
        
        // ==================== ë©”ì¸ ì•± ====================
        async function showMainApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('greetingText').textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.name}ë‹˜! ğŸ‘‹`;
            
            // ê´€ë¦¬ìë©´ ê´€ë¦¬ íƒ­ë§Œ ë³´ì´ê¸°
            if (currentUser.role === 'admin') {
                document.getElementById('adminNav').style.display = 'flex';
                // ë‹¤ë¥¸ íƒ­ ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.nav-item').forEach(nav => {
                    if (nav.id !== 'adminNav') {
                        nav.style.display = 'none';
                    }
                });
                // ê´€ë¦¬ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('adminPage').classList.add('active');
                document.getElementById('adminNav').classList.add('active');
                await loadAdminData();
            } else {
                await loadTodayAttendance();
                await loadWeeklyAttendance();
                await loadSchedule();
                await loadTeamStatus();
                await loadLeaveInfo();
            }
        }
        
        // ==================== ì¶œí‡´ê·¼ ====================
        async function loadTodayAttendance() {
            try {
                const res = await fetch(`${API_BASE}/api/attendance/today/${currentUser.id}`);
                if (!res.ok) {
                    console.error('API ì˜¤ë¥˜:', res.status);
                    return;
                }
                const data = await res.json();
                
                const statusEl = document.getElementById('todayStatus');
                const timeEl = document.getElementById('workTime');
                const detailEl = document.getElementById('clockTimes');
                const btnIn = document.getElementById('btnClockIn');
                const btnOut = document.getElementById('btnClockOut');
                
                // ì´ ê·¼ë¬´ì‹œê°„ ê³„ì‚° (ì™„ë£Œëœ ì„¸ì…˜ + í˜„ì¬ ì„¸ì…˜)
                let totalMinutes = data.work_minutes || 0;
                if (data.current_minutes) {
                    totalMinutes += data.current_minutes;
                }
                
                const hours = Math.floor(totalMinutes / 60);
                const mins = totalMinutes % 60;
                timeEl.textContent = `${hours}ì‹œê°„ ${mins}ë¶„`;
                
                if (data.is_working) {
                    // ê·¼ë¬´ ì¤‘
                    statusEl.textContent = 'ğŸŸ¢ ê·¼ë¬´ì¤‘';
                    statusEl.className = 'status-badge working';
                    btnIn.disabled = true;
                    btnIn.dataset.clocked = 'true';
                    btnOut.disabled = false;
                    
                    // í˜„ì¬ ì„¸ì…˜ì˜ ì¶œê·¼ ì‹œê°„ ì°¾ê¸°
                    const currentSession = data.sessions ? data.sessions.find(s => !s.clock_out) : null;
                    detailEl.textContent = currentSession ? `ì¶œê·¼ ${currentSession.clock_in}` : `ì¶œê·¼ ${data.clock_in}`;
                    
                    // ì¶œê·¼ ì‹œê°„ ë³µì› (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ëŒ€ë¹„)
                    if (!clockInTime && currentSession) {
                        const [h, m] = currentSession.clock_in.split(':');
                        clockInTime = new Date();
                        clockInTime.setHours(parseInt(h), parseInt(m), 0);
                    }
                    
                    // 1ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸
                    setTimeout(loadTodayAttendance, 60000);
                } else if (data.clock_in) {
                    // í‡´ê·¼ ì™„ë£Œ (ë‹¤ì‹œ ì¶œê·¼ ê°€ëŠ¥!)
                    statusEl.textContent = 'í‡´ê·¼';
                    statusEl.className = 'status-badge done';
                    btnIn.disabled = false;  // ë‹¤ì‹œ ì¶œê·¼ ê°€ëŠ¥!
                    btnIn.dataset.clocked = '';
                    btnOut.disabled = true;
                    detailEl.textContent = data.sessions && data.sessions.length > 1 
                        ? `${data.sessions.length}íšŒ ì¶œí‡´ê·¼` 
                        : `${data.clock_in} ~ ${data.clock_out || ''}`;
                    
                    // í‡´ê·¼ ìƒíƒœë©´ ë¦¬ì…‹
                    clockInTime = null;
                    outsideStartTime = null;
                } else {
                    // ë¯¸ì¶œê·¼
                    statusEl.textContent = 'ë¯¸ì¶œê·¼';
                    statusEl.className = 'status-badge not-working';
                    btnIn.disabled = false;
                    btnIn.dataset.clocked = '';
                    btnOut.disabled = true;
                    detailEl.textContent = '-';
                    
                    clockInTime = null;
                    outsideStartTime = null;
                }
            } catch (e) {
                console.error('loadTodayAttendance ì˜¤ë¥˜:', e);
            }
        }
        
        async function clockIn() {
            if (!currentLocation) {
                showToast('ìœ„ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ì–´ìš”. ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            try {
                const res = await fetch(`${API_BASE}/api/attendance/clock-in`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        latitude: currentLocation.latitude,
                        longitude: currentLocation.longitude
                    })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                // ì¶œê·¼ ì‹œê°„ ê¸°ë¡
                clockInTime = new Date();
                outsideStartTime = null;
                insideStartTime = null;
                alarmShown = false;
                
                showToast(data.message);
                await loadTodayAttendance();
                await loadWeeklyAttendance();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        async function clockOut() {
            try {
                const res = await fetch(`${API_BASE}/api/attendance/clock-out`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser.id })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                // ì‹œê°„ ê¸°ë¡ ë¦¬ì…‹
                clockInTime = null;
                outsideStartTime = null;
                
                showToast(data.message);
                await loadTodayAttendance();
                await loadWeeklyAttendance();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        async function loadWeeklyAttendance() {
            const data = await fetch(`${API_BASE}/api/attendance/weekly/${currentUser.id}`).then(r => r.json());
            
            document.getElementById('weeklyProgress').style.width = `${data.progress_percent}%`;
            document.getElementById('weeklyHours').textContent = `${data.total_hours}ì‹œê°„ / ${data.target_hours}ì‹œê°„`;
            
            const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            const today = new Date().toISOString().split('T')[0];
            
            document.getElementById('dailyList').innerHTML = data.daily.map((d, i) => {
                const hours = Math.round(d.minutes / 60 * 10) / 10;
                const isToday = d.date === today;
                let display = d.leave || `${hours}h`;
                let cls = isToday ? 'today' : (d.leave ? 'leave' : '');
                
                return `<div class="daily-item">
                    <div class="daily-day">${days[i]}</div>
                    <div class="daily-hours ${cls}">${display}</div>
                </div>`;
            }).join('');
        }
        
        // ==================== ì¼ì • ====================
        async function loadSchedule() {
            const data = await fetch(`${API_BASE}/api/schedule/week/${currentUser.id}`).then(r => r.json());
            const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            
            document.getElementById('scheduleList').innerHTML = data.map((s, i) => `
                <div class="schedule-item" data-date="${s.date}">
                    <div class="schedule-day">${days[i]}</div>
                    <div class="schedule-time">
                        <input type="time" class="schedule-in" value="${s.planned_in}">
                        <span>~</span>
                        <input type="time" class="schedule-out" value="${s.planned_out}">
                    </div>
                </div>
            `).join('');
        }
        
        async function saveSchedule() {
            const items = document.querySelectorAll('#scheduleList .schedule-item');
            
            for (const item of items) {
                const date = item.dataset.date;
                const planned_in = item.querySelector('.schedule-in').value;
                const planned_out = item.querySelector('.schedule-out').value;
                
                await fetch(`${API_BASE}/api/schedule/update`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        date, planned_in, planned_out
                    })
                });
            }
            
            showToast('ì¼ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ==================== íŒ€ í˜„í™© ====================
        async function loadTeamStatus() {
            const data = await fetch(`${API_BASE}/api/team/status/${currentUser.team_id}`).then(r => r.json());
            
            document.getElementById('teamList').innerHTML = data.map(m => {
                let statusClass = 'not-working';
                if (m.status === 'ê·¼ë¬´ì¤‘') statusClass = 'working';
                else if (m.status === 'í‡´ê·¼') statusClass = 'done';
                else if (m.status.includes('ì°¨') || m.status === 'ì—°ì°¨') statusClass = 'leave';
                
                const emoji = m.name.charAt(0);
                const timeInfo = m.clock_in 
                    ? (m.clock_out ? `${m.clock_in}~${m.clock_out}` : `${m.clock_in} ì¶œê·¼`)
                    : `ì˜ˆì • ${m.planned_in}~${m.planned_out}`;
                
                return `<div class="member-card" onclick="showMemberSchedule(${m.id}, '${m.name}')" style="cursor:pointer;">
                    <div class="member-avatar">${emoji}</div>
                    <div class="member-info">
                        <div class="member-name">${m.name}</div>
                        <div class="member-schedule">${timeInfo}</div>
                    </div>
                    <div class="member-status ${statusClass}">${m.status}</div>
                </div>`;
            }).join('');
        }
        
        async function showMemberSchedule(userId, userName) {
            document.getElementById('memberScheduleTitle').textContent = `ğŸ“… ${userName}ë‹˜ ì´ë²ˆ ì£¼ ì¼ì •`;
            document.getElementById('memberScheduleModal').classList.add('show');
            
            // ë¡œë”© í‘œì‹œ
            document.getElementById('memberScheduleContent').innerHTML = '<p style="text-align:center; color:#9ca3af;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            
            // ì£¼ê°„ ì¼ì • ê°€ì ¸ì˜¤ê¸°
            const schedule = await fetch(`${API_BASE}/api/schedule/week/${userId}`).then(r => r.json());
            const leaves = await fetch(`${API_BASE}/api/leave/user-week/${userId}`).then(r => r.json());
            
            const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            const today = new Date().toISOString().split('T')[0];
            
            let html = '<div style="margin-top:10px;">';
            schedule.forEach((s, i) => {
                const isToday = s.date === today;
                const leave = leaves.find(l => l.date === s.date);
                const leaveText = leave ? {annual: 'ğŸ–ï¸ ì—°ì°¨', half_am: 'ğŸŒ… ì˜¤ì „ë°˜ì°¨', half_pm: 'ğŸŒ‡ ì˜¤í›„ë°˜ì°¨'}[leave.type] : null;
                
                html += `<div style="display:flex; justify-content:space-between; padding:12px; ${isToday ? 'background:#EEF2FF; border-radius:8px;' : 'border-bottom:1px solid #f3f4f6;'}">
                    <div style="font-weight:${isToday ? '600' : '400'}; color:${isToday ? '#4F46E5' : '#1f2937'};">
                        ${days[i]} ${isToday ? '(ì˜¤ëŠ˜)' : ''}
                    </div>
                    <div style="color:${leaveText ? '#F59E0B' : '#6b7280'};">
                        ${leaveText || `${s.planned_in} ~ ${s.planned_out}`}
                    </div>
                </div>`;
            });
            html += '</div>';
            
            document.getElementById('memberScheduleContent').innerHTML = html;
        }
        
        function closeMemberSchedule() {
            document.getElementById('memberScheduleModal').classList.remove('show');
        }
        
        // ==================== íœ´ê°€ ====================
        async function loadLeaveInfo() {
            try {
                const res = await fetch(`${API_BASE}/api/auth/user/${currentUser.id}`);
                if (!res.ok) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                    return;
                }
                const user = await res.json();
                
                const total = user.annual_leave_total || 15;
                const used = user.annual_leave_used || 0;
                const remaining = total - used;
                
                document.getElementById('leaveBalance').textContent = `${remaining}ì¼`;
                document.getElementById('leaveUsed').textContent = `ì‚¬ìš©: ${used}ì¼ / ì´: ${total}ì¼`;
                document.getElementById('totalAnnualLeave').value = total;
                
                // íœ´ê°€ ë‚´ì—­
                const leavesRes = await fetch(`${API_BASE}/api/leave/my/${currentUser.id}`);
                const leaves = leavesRes.ok ? await leavesRes.json() : [];
                
                document.getElementById('leaveList').innerHTML = leaves.length 
                    ? leaves.map(l => {
                        const type = {annual: 'ì—°ì°¨', half_am: 'ì˜¤ì „ë°˜ì°¨', half_pm: 'ì˜¤í›„ë°˜ì°¨'}[l.type];
                        return `<div class="member-card">
                            <div class="member-info">
                                <div class="member-name">${l.date}</div>
                                <div class="member-schedule">${type}</div>
                            </div>
                            <button onclick="cancelLeave(${l.id})" style="color:#EF4444; border:none; background:none; cursor:pointer;">ì·¨ì†Œ</button>
                        </div>`;
                    }).join('')
                    : '<p style="color:#9ca3af; text-align:center; padding:20px;">ë“±ë¡ëœ íœ´ê°€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
            } catch (e) {
                console.error('loadLeaveInfo ì˜¤ë¥˜:', e);
                document.getElementById('leaveBalance').textContent = '15ì¼';
                document.getElementById('leaveUsed').textContent = 'ì‚¬ìš©: 0ì¼ / ì´: 15ì¼';
            }
        }
        
        function selectLeaveType(el, type) {
            document.querySelectorAll('.leave-type-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            selectedLeaveType = type;
        }
        
        async function submitLeave() {
            const date = document.getElementById('leaveDate').value;
            
            try {
                const res = await fetch(`${API_BASE}/api/leave`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        date,
                        type: selectedLeaveType
                    })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                showToast(data.message);
                await loadLeaveInfo();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        async function cancelLeave(leaveId) {
            if (!confirm('íœ´ê°€ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            await fetch(`${API_BASE}/api/leave/${leaveId}`, { method: 'DELETE' });
            showToast('íœ´ê°€ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤');
            await loadLeaveInfo();
        }
        
        async function updateAnnualLeave() {
            const total = parseFloat(document.getElementById('totalAnnualLeave').value);
            
            await fetch(`${API_BASE}/api/user/annual-leave`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: currentUser.id,
                    annual_leave_total: total
                })
            });
            
            showToast('ì—°ì°¨ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            await loadLeaveInfo();
        }
        
        // ==================== ê¸°ë¡ ìˆ˜ì • ====================
        function openEditModal() {
            document.getElementById('editModal').classList.add('show');
        }
        
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }
        
        async function saveEdit() {
            const date = document.getElementById('editDate').value;
            const clock_in = document.getElementById('editClockIn').value || null;
            const clock_out = document.getElementById('editClockOut').value || null;
            
            try {
                const res = await fetch(`${API_BASE}/api/attendance/update`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        date, clock_in, clock_out
                    })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                showToast(data.message);
                closeEditModal();
                await loadTodayAttendance();
                await loadWeeklyAttendance();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        // ==================== ìœ í‹¸ë¦¬í‹° ====================
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`${page}Page`).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // í˜ì´ì§€ë³„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            if (page === 'team') loadTeamStatus();
            if (page === 'leave') loadLeaveInfo();
            if (page === 'admin') loadAdminStatus();
        }
        
        async function loadAdminStatus() {
            const data = await fetch(`${API_BASE}/api/admin/all-status`).then(r => r.json());
            
            document.getElementById('adminList').innerHTML = data.map(m => {
                let statusClass = 'not-working';
                if (m.status === 'ê·¼ë¬´ì¤‘') statusClass = 'working';
                else if (m.status === 'í‡´ê·¼') statusClass = 'done';
                else if (m.status.includes('ì°¨') || m.status === 'ì—°ì°¨') statusClass = 'leave';
                
                const emoji = m.name.charAt(0);
                const hours = Math.floor((m.work_minutes || 0) / 60);
                const mins = (m.work_minutes || 0) % 60;
                const timeInfo = m.clock_in 
                    ? (m.clock_out ? `${m.clock_in}~${m.clock_out} (${hours}ì‹œê°„ ${mins}ë¶„)` : `${m.clock_in} ì¶œê·¼`)
                    : '-';
                
                const isAdmin = m.role === 'admin';
                const roleBtn = isAdmin 
                    ? `<button onclick="changeRole(${m.id}, 'member')" style="background:#EF4444; color:white; border:none; padding:5px 10px; border-radius:5px; font-size:12px; cursor:pointer;">ğŸ‘‘ í•´ì œ</button>`
                    : `<button onclick="changeRole(${m.id}, 'admin')" style="background:#4F46E5; color:white; border:none; padding:5px 10px; border-radius:5px; font-size:12px; cursor:pointer;">ê´€ë¦¬ì ì§€ì •</button>`;
                
                return `<div class="member-card">
                    <div class="member-avatar">${emoji}</div>
                    <div class="member-info">
                        <div class="member-name">${m.name} ${isAdmin ? 'ğŸ‘‘' : ''} <span style="font-size:12px; color:#9ca3af;">${m.team || ''}</span></div>
                        <div class="member-schedule">${timeInfo}</div>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:flex-end; gap:5px;">
                        <div class="member-status ${statusClass}">${m.status}</div>
                        ${roleBtn}
                    </div>
                </div>`;
            }).join('');
        }
        
        async function changeRole(userId, newRole) {
            const action = newRole === 'admin' ? 'ê´€ë¦¬ìë¡œ ì§€ì •' : 'ê´€ë¦¬ì ê¶Œí•œ í•´ì œ';
            if (!confirm(`ì´ ì‚¬ìš©ìë¥¼ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const res = await fetch(`${API_BASE}/api/user/role`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, role: newRole })
                });
                
                const data = await res.json();
                showToast(data.message);
                await loadAdminStatus();
            } catch (e) {
                showToast('ê¶Œí•œ ë³€ê²½ ì‹¤íŒ¨');
            }
        }
        
        // ==================== ê´€ë¦¬ì íƒ­ ê¸°ëŠ¥ ====================
        async function loadAdminData() {
            await loadAdminStatus();
            await loadAdminTeams();
        }
        
        function showAdminTab(tab) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.getElementById('adminStatusTab').style.display = 'none';
            document.getElementById('adminHoursTab').style.display = 'none';
            document.getElementById('adminTeamTab').style.display = 'none';
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë¦¬ì…‹
            document.getElementById('adminTab1').style.background = '#e5e7eb';
            document.getElementById('adminTab1').style.color = '#374151';
            document.getElementById('adminTab2').style.background = '#e5e7eb';
            document.getElementById('adminTab2').style.color = '#374151';
            document.getElementById('adminTab3').style.background = '#e5e7eb';
            document.getElementById('adminTab3').style.color = '#374151';
            
            // ì„ íƒëœ íƒ­ ë³´ì´ê¸°
            if (tab === 'status') {
                document.getElementById('adminStatusTab').style.display = 'block';
                document.getElementById('adminTab1').style.background = '#4F46E5';
                document.getElementById('adminTab1').style.color = 'white';
                loadAdminStatus();
            } else if (tab === 'hours') {
                document.getElementById('adminHoursTab').style.display = 'block';
                document.getElementById('adminTab2').style.background = '#4F46E5';
                document.getElementById('adminTab2').style.color = 'white';
                loadAdminHours('week');
            } else if (tab === 'team') {
                document.getElementById('adminTeamTab').style.display = 'block';
                document.getElementById('adminTab3').style.background = '#4F46E5';
                document.getElementById('adminTab3').style.color = 'white';
                loadAdminTeams();
            }
        }
        
        async function loadAdminHours(period) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.getElementById('hoursWeekBtn').style.background = period === 'week' ? '#4F46E5' : '#e5e7eb';
            document.getElementById('hoursWeekBtn').style.color = period === 'week' ? 'white' : '#374151';
            document.getElementById('hoursMonthBtn').style.background = period === 'month' ? '#4F46E5' : '#e5e7eb';
            document.getElementById('hoursMonthBtn').style.color = period === 'month' ? 'white' : '#374151';
            
            try {
                const data = await fetch(`${API_BASE}/api/admin/hours?period=${period}`).then(r => r.json());
                
                const periodLabel = period === 'week' ? 'ì´ë²ˆ ì£¼' : 'ì´ë²ˆ ë‹¬';
                const targetHours = period === 'week' ? 40 : 160;
                
                document.getElementById('adminHoursList').innerHTML = data.map(m => {
                    const hours = Math.round(m.total_minutes / 60 * 10) / 10;
                    const percent = Math.min(100, Math.round(m.total_minutes / 60 / targetHours * 100));
                    const color = percent >= 100 ? '#10B981' : (percent >= 70 ? '#F59E0B' : '#EF4444');
                    
                    return `<div class="member-card">
                        <div class="member-avatar">${m.name.charAt(0)}</div>
                        <div class="member-info" style="flex:1;">
                            <div class="member-name">${m.name} <span style="font-size:12px; color:#9ca3af;">${m.team || ''}</span></div>
                            <div style="margin-top:5px;">
                                <div style="background:#e5e7eb; height:8px; border-radius:4px; overflow:hidden;">
                                    <div style="background:${color}; height:100%; width:${percent}%;"></div>
                                </div>
                                <div style="font-size:12px; color:#6b7280; margin-top:3px;">${hours}ì‹œê°„ / ${targetHours}ì‹œê°„ (${percent}%)</div>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (e) {
                console.error('ê·¼ë¬´ì‹œê°„ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }
        
        async function loadAdminTeams() {
            try {
                const teams = await fetch(`${API_BASE}/api/teams`).then(r => r.json());
                
                document.getElementById('adminTeamList').innerHTML = teams.map(t => `
                    <div class="member-card">
                        <div class="member-avatar">ğŸ¢</div>
                        <div class="member-info">
                            <div class="member-name">${t.name}</div>
                        </div>
                        <button onclick="deleteTeam(${t.id}, '${t.name}')" style="color:#EF4444; border:none; background:none; cursor:pointer; font-size:18px;">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
            } catch (e) {
                console.error('íŒ€ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }
        
        async function createTeam() {
            const name = document.getElementById('newTeamName').value.trim();
            if (!name) {
                showToast('íŒ€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            try {
                const res = await fetch(`${API_BASE}/api/teams`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name })
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                showToast('íŒ€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('newTeamName').value = '';
                await loadAdminTeams();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        async function deleteTeam(teamId, teamName) {
            if (!confirm(`"${teamName}" íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const res = await fetch(`${API_BASE}/api/teams/${teamId}`, { method: 'DELETE' });
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                showToast('íŒ€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                await loadAdminTeams();
            } catch (e) {
                showToast(e.message);
            }
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
